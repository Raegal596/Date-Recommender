{% extends "base.html" %}

{% block content %}
<header class="app-header">
    <div class="logo">ü¶îüíñü¶î</div>
    <h1>Date Recommender</h1>
</header>

<main>

    <div class="welcome-card">
        <h2>Hello! Ready for a date?</h2>
        <p>Let's find something magical to do today.</p>

        <div class="search-container">
            <button id="findDateBtn" class="cta-button">Find Us a Date ‚ú®</button>
            <p id="statusMessage" class="status-message"></p>
        </div>

        <script>
            document.getElementById('findDateBtn').addEventListener('click', function () {
                const statusMsg = document.getElementById('statusMessage');
                statusMsg.textContent = "Locating you...";

                if (!navigator.geolocation) {
                    statusMsg.textContent = "Geolocation is not supported by your browser.";
                    return;
                }

                navigator.geolocation.getCurrentPosition(success, error);

                async function success(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    statusMsg.textContent = "Location found! Identifying city...";

                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                        const data = await response.json();
                        const city = data.address.city || data.address.town || data.address.village || data.address.county || "";

                        statusMsg.textContent = "Consulting the love hedgehogs... ü¶î";
                        window.location.href = `/recommend?lat=${latitude}&long=${longitude}&city=${encodeURIComponent(city)}`;
                    } catch (e) {
                        statusMsg.textContent = "Consulting the love hedgehogs... ü¶î";
                        window.location.href = `/recommend?lat=${latitude}&long=${longitude}`;
                    }
                }

                function error() {
                    statusMsg.textContent = "Unable to retrieve your location. Please allow location access.";
                }
            });
        </script>
    </div>

    <div class="interests-section">
        <details class="interests-dropdown">
            <summary>
                <h3>Your Shared Interests</h3><span class="dropdown-icon">‚ñº</span>
            </summary>
            <div class="interests-content">
                {{ interests | safe }}
            </div>
        </details>
    </div>
</main>

<nav class="bottom-nav">
    <a href="#" class="active">üè† Home</a>
    <a href="#">‚ù§Ô∏è Saved</a>
    <a href="#">üë§ Profile</a>
</nav>
{% endblock %}